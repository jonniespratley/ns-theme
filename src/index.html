<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Stencil Component Starter</title>
    <link rel="stylesheet" href="https://assets.codepen.io/49212/font.css" />
    <style>
      html:not(.hydrated) body {
        opacity: 0;
      }
      .hydrated body {
        opacity: 1;
      }
      html,
      body {
        margin: 0;
        padding: 0;
      }
    </style>
    <!--
 <link rel="stylesheet" href="https://assets.codepen.io/49212/font.css">
    
    <link rel="stylesheet" href="https://north-star-ui-cdn.run.aws-usw02-pr.ice.predix.io/css/px-light-theme.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.0/css/font-awesome.css"/>
  
    <link rel="stylesheet" href="http://localhost:9001/src.77de5100.css">
    -->
    <script>
      window.nav = {
        main: {
          items: [
            {
              label: 'Polling App',
              icon: 'fa-html5',
              path: '/pollapp',
              items: [],
              order: 1,
              default: false,
              id: 'pollapp.0',
            },
            {
              label: 'Mocha App',
              icon: 'fa-code',
              path: '/testapp',
              items: [],
              order: 0,
              default: true,
              id: 'testapp.0',
            },
            {
              label: 'AngularApp',
              icon: 'fa-handicap',
              path: '/angularapp',
              items: [],
              order: 3,
              id: 'angularapp.0',
            },
            {
              label: 'PolymerApp',
              icon: 'fa-cube',
              path: '/polymerapp',
              items: [],
              order: 5,
              default: false,
              id: 'polymerapp.0',
            },
            {
              label: 'TraceID App',
              icon: 'fa-heartbeat',
              path: '/sample-traceid-app',
              items: [],
              order: 7,
              default: false,
              id: 'app2.0',
            },
            {
              label: 'StoppedMicroapp',
              icon: 'fa-circle',
              path: '/stoppedmicroapp',
              items: [],
              order: 10,
              default: false,
              id: 'stoppedmicroapp.0',
            },
          ],
        },
        profile: {
          items: [
            {
              label: 'My Profile',
              icon: 'fa-user',
              path: '/profile',
              items: [],
              order: 13,
              default: false,
              id: 'profileapp.0',
            },
          ],
        },
        settings: {
          items: [
            {
              label: 'Settings App',
              icon: 'fa-gear',
              path: '/settings',
              items: [],
              order: 12,
              default: false,
              id: 'settings.0',
            },
          ],
        },
        paths: {
          pollapp: '/pollapp',
          testapp: '/testapp',
          angularapp: '/angularapp',
          polymerapp: '/polymerapp',
          app2: '/sample-traceid-app',
          stoppedmicroapp: '/stoppedmicroapp',
          settings: '/settings',
          profileapp: '/profile',
        },
        contextPath: '',
        user: {
          name: '@jonniespratley',
          firstName: 'Jonnie',
          lastName: 'Spratley',
          picture: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/49212/profile/profile-80.jpg?4',
          user_id: 'cef303ee-0830-4589-adae-b37088555946',
          user_name: 'test',
          email: 'jonniespratley@gmail.com',
        },
        preferences: {
          preferredLocale: 'en',
        },
        appName: 'AppHub Dev',
        localeData: {
          logOut: 'Log Out',
          toastTextDefault: 'You received a new notification.',
          toastActionLabelDefault: 'Action',
        },
      };
    </script>

    <script type="module" src="/build/ns-theme.esm.js"></script>
    <script nomodule src="/build/ns-theme.js"></script>
  </head>
  <body>
    <ns-theme-header id="headerExample" show-menu slot="header">
      <ns-theme-tabs id="exampleTabs" slot="tabs"></ns-theme-tabs>
      <div slot="user">
        <div class="btn btn-count">
          <i class="gedi-square"></i>
          <span>0</span>
        </div>
      </div>
    </ns-theme-header>

    <ns-theme-panels id="examplePanels" slot="content"> </ns-theme-panels>

    <ns-theme-drawer id="nsThemeTabsDrawer" header-text="Tab Management" slot="drawer" anchor="right">
      <ns-theme-list-group id="nsThemeTabsList"></ns-theme-list-group>
    </ns-theme-drawer>

    <div id="js-menu"></div>
    <div id="js-user-menu"></div>

    <!--
      <h2>ns-theme-header demo</h2>

      <ns-theme-header id="headerExample">
        <div slot="left">Left</div>
        <div slot="tabs"">Tab area</div>
        <div slot="right">Right side</div>
      </ns-theme-header>
      <br/>
      <ns-theme-header id="headerExample2">
        <div slot="menu">Menu Icon</div>
        <div slot="home">home</div>
        <div slot="left">Left</div>
        <div slot="tabs"">Tab area</div>
        <div slot="right">Right side</div>
      </ns-theme-header>
      <br>
      
      <h3>With Menu</h3>
      <ns-theme-header id="headerExample3" show-menu="true"></ns-theme-header>
      
      <h3>With Menu + Home</h3>
      <ns-theme-header id="headerExample4" show-menu="true" show-home="true"></ns-theme-header>
    
    
    <ns-theme-drawer id="d3" anchor="right" header-text="Tab Manager">
      <div slot="content"><ns-theme-list-group></ns-theme-list-group></div>
    </ns-theme-drawer>

    <ns-theme-drawer id="d1" anchor="left">
      <p>This is DEFAULT drawer 1</p>
    </ns-theme-drawer>
    <ns-theme-drawer id="d2" anchor="top">
      <p>This is top drawer 2</p>
    </ns-theme-drawer>
    <ns-theme-drawer id="d4" anchor="bottom">
      <p>This is bottom drawer</p>
    </ns-theme-drawer>
    <br />
    <button id="d1btn">left drawer</button>
    <button id="d2btn">top drawer</button>
    <button id="d3btn">right drawer</button>
    <button id="d4btn">bottom drawer</button>
    -->

    <style>
      .btn.btn-count {
        position: relative;

        width: 28px;
        height: 28px;
        align-items: center;
        cursor: pointer;
      }

      .btn.btn-count > i {
        position: absolute;
        left: 0%;
        top: 0%;
        font-size: 2rem;
        transform: translate3d(-3px, -3px, 0px);
      }

      .btn-count span {
        position: absolute;
        transform: translate(0, 30%);
        font-size: 0.7rem;
        text-align: center;
        left: 0;
        top: 3px;
        width: 25px;
      }
    </style>

    <button id="addTab">Add Tab</button>

    <style>
      .content {
        height: 99vh;
        background: white;
        color: black;
        padding: 1rem;
        padding-top: 3rem;
      }
    </style>

    <script>
      (async () => {
        let count = 0;

        await customElements.whenDefined('ns-theme');
        const nsTheme = document.querySelector('ns-theme');
        // nsTheme.setAttribute('session', window.nav);

        await customElements.whenDefined('ns-theme-tabs');
        const nsThemeTabs = document.querySelector('ns-theme-tabs');

        const nsThemeTabsList = document.querySelector('#nsThemeTabsList');
        const nsThemePanels = document.querySelector('ns-theme-panels');
        const nsTabCount = document.querySelector('.btn-count span');

        async function toggleTab(tab) {
          await nsThemeTabs.toggleTab(tab);
          await nsThemePanels.togglePanel(tab);
          return tab;
        }

        async function closeTab(tab) {
          //await nsThemeTabs.closeTab(tab);
          await nsThemePanels.closePanel(tab);
          return tab;
        }

        async function closeAllTabs() {
          let allTabsMap = await nsThemeTabs.getTabs();
          let allTabs = Object.values(allTabsMap).filter(t => t.home !== true);

          return Promise.all(allTabs.map(t => closeTab(t)));
        }

        async function selectHomeTab() {
          let tab = await nsThemeTabs.selectHomeTab();
          await nsThemeTabs.toggleTab(tab);
          await nsThemePanels.togglePanel(tab);
          return tab;
        }

        document.addEventListener('drawerHeaderAction', e => {
          console.log('Action', e);
          closeAllTabs();
        });

        nsTabCount.addEventListener('click', () => {
          document.querySelector('#nsThemeTabsDrawer').toggle();
        });

        // TODO - Listen for change to tabs only
        nsThemeTabs.addEventListener('tabChange', e => {
          let tabs = Object.values(e.detail);
          nsThemeTabsList.items = tabs;
          nsTabCount.innerHTML = tabs.length;
        });

        // TODO - Listen for tabClick on entire document
        document.addEventListener('tabClick', e => {
          e.preventDefault();
          toggleTab(e.detail);
        });

        // TODO - Close panel when tab is closed.
        document.addEventListener('tabClose', async e => {
          await closeTab(e.detail);
          await selectHomeTab();
        });

        function createTab(obj) {
          let t = {
            id: count === 0 ? 'home' : `app-${count}`,
            label: `Tab ${count}`,
            href: `/some-app/${count}`,
            panelId: `panel-${count}`,
            ...obj,
          };
          return t;
        }

        function createPane(t) {
          let pane = document.createElement('div');
          pane.id = t.panelId;
          pane.innerHTML = `
              <h4>${t.id}</h4>
              <p>This is the tab content</p>
              `;
          return pane;
        }

        async function addTab(obj) {
          count++;
          let t = createTab(obj);
          let pane = createPane(t);
          let newTab = await nsThemeTabs.addTab(t);
          let newPanel = await nsThemePanels.addPanel(newTab, pane);
          return await toggleTab(newTab);
        }

        document.addEventListener('DOMContentLoaded', () => {
          let sortedItems = window.nav.main.items.sort((a, b) => {
            return a.order - b.order;
          });
          // TODO - SET THE DEFAULT TAB
          let defaultTab = sortedItems.find(item => item.default === true);
          defaultTab.home = true;
          defaultTab.title = 'Default';
          addTab(defaultTab);

          document.addEventListener('menuToggleClick', () => {
            console.log('toggle js-menu menu');
            //document.querySelector('#js-menu [data-testid="app-menu__toggle"]').click();
          });

          document.querySelector('#addTab').addEventListener('click', () => {
            addTab();
          });
        });
      })();
    </script>
  </body>
</html>
